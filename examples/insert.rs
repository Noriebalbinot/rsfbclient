//!
//! Rust Firebird Client
//!
//! Example of insert
//!
//! You need create a database with this table:
//! create table test (col_a int generated by default as identity, col_b float, col_c varchar(10));
//!

#![allow(unused_variables, unused_mut)]

use rsfbclient::{prelude::*, ConnectionBuilder, FbError};

const SQL_INSERT: &str = "insert into test (col_b, col_c) values (?, ?)";

fn main() -> Result<(), FbError> {
    #[cfg(feature = "linking")]
    let conn = ConnectionBuilder::linked()
        .host("localhost")
        .db_name("examples.fdb")
        .user("SYSDBA")
        .pass("masterkey")
        .connect()?;

    #[cfg(feature = "dynamic_loading")]
    let conn = ConnectionBuilder::with_client("./fbclient.lib")
        .host("localhost")
        .db_name("examples.fdb")
        .user("SYSDBA")
        .pass("masterkey")
        .connect()?;

    #[cfg(feature = "pure_rust")]
    let mut conn = ConnectionBuilder::pure_rust()
        .host("localhost")
        .db_name("examples.fdb")
        .user("SYSDBA")
        .pass("masterkey")
        .connect()?;

    conn.with_transaction(|tr| {
        // First alternative (Recommended) (Prepares if needed and executes automatically)
        tr.execute(SQL_INSERT, (94, "Banana"))?;

        // Second alternative
        // tr.execute_immediate(SQL_INSERT, (-39, "test"))?;

        // Third alternative
        {
            let mut stmt = tr.prepare(SQL_INSERT)?;

            stmt.execute(tr, (-39, "test"))?;
            stmt.execute(tr, (12, "test 2"))?;
        }

        Ok(())
    })?;

    // Explicit close is optional
    conn.close()?;

    Ok(())
}
